$.fn.simplePlaceholder=function(){$(this).each(function(){var a=$(this);a.focus(function(){if($.trim(a.val())===a.attr("placeholder")){a.removeClass("placeholder").val("")}}).blur(function(){if($.trim(a.val())===""){a.addClass("placeholder").val(a.attr("placeholder"))}});if(!$.trim(a.val())||a.val()===$.trim(a.attr("placeholder"))){a.addClass("placeholder").val(a.attr("placeholder"))}})};var API_CINEMAS_SUGGESTION="/j/cinema_search";$.fn.searchCinema=function(g){var d=0,f="",a=$("#cinemas-suggestion-list"),e={searchCallback:"",itemCallback:""},c=g?$.extend({},e,g):e,b=$(this);a.delegate("li","hover",function(h){a.find(".hover").removeClass("hover");$(this).toggleClass("hover")}).delegate("li:not(.result-title)","click",function(h){h.preventDefault();$.isFunction(c.itemCallback)?c.itemCallback(h):window.location.href=$(this).find("a").attr("href");$("#cinemas-suggestion-input").find("input").val($(this).find("strong").text().replace("<em>","").replace("</em/>",""))});b.find("input").bind("keyup",function(n){var h=new Date(),i=h-d,q,m,j,k,p=$(this),l=$.trim(p.val());if((d===0&&l.length>1||l.length>1&&i>200)&&n.keyCode!==38&&n.keyCode!==40&&n.keyCode!==13){a.hide().empty();if(f){f.abort()}f=$.post_withck(API_CINEMAS_SUGGESTION,{q:l,city_id:$("#city-id").data("city-id")},function(s){var v=$.parseJSON(s);if(v.length){var t=$("<ul></ul>"),u;for(u=0;u<v.length;u++){var w=v[u],r={id:w.id,name:w.name.replace(l,"<em>"+l+"</em>"),address:w.address.replace(l,"<em>"+l+"</em>"),siteUrl:w.url},x=$("#mt-cinemas-suggestion").tmpl(r);t.append(x)}a.append(t).show()}})}d=h;if(a.is(":visible")){q=a.find("li").length-1;m=a.find("li").index(a.find(".hover"));j=(m===0||m===-1)?q:m-1;k=m===q?0:m+1;var o=a.find("li");switch(n.keyCode){case 38:o.removeClass("hover").eq(j).addClass("hover");p.val(o.eq(j).find("strong").text());break;case 40:o.removeClass("hover").eq(k).addClass("hover");p.val(o.eq(k).find("strong").text());break;case 13:if(a.find(".hover").length){a.find(".hover").trigger("click")}break;default:}}else{if($.trim(p.val())){if(n.keyCode===13){b.find("#cinemas-suggestion-search").trigger("click")}}}}).bind("focus",function(m){m.stopPropagation();$(m.target).val("");if(f){f.abort()}var k,h,j,i,l=$(this);f=$.post_withck(API_CINEMAS_SUGGESTION,{q:"",city_id:$("#city-id").data("city-id")},function(o){var r=$.parseJSON(o);if(r.length){var p=$('<ul class="auto-tip"></ul>'),q,t=r[0]["src"];if(t==="user"){p.append('<li class="result-title">常去影院</li>')}else{if(t==="ticket"){p.append('<li class="result-title">可售票影院</li>')}}for(q=0;q<r.length;q++){var s=r[q],n={id:s.id,name:s.name,siteUrl:s.url},u=$("#mt-cinemas-suggestion").tmpl(n);p.append(u)}a.append(p).show()}});return false}).end().find("#cinemas-suggestion-search").bind("click",function(i){i.preventDefault();var j=$("#cinemas-suggestion-input input");j.focus();if($.trim(j.val())&&$.isFunction(c.searchCallback)){c.searchCallback()}else{var h="/cinemas/"+$("#city-id").data("city-id")+"/?q="+$.trim(j.val());window.location.href=h}});$(document).bind("click",function(h){if(!$(h.target).is("#cinemas-suggestion-input input")&&$(h.target).parents("#search-results").length===0&&h.keyCode!==38&&h.keyCode!==40&&h.keyCode!==13){a.empty().hide()}})};